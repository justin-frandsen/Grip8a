<!DOCTYPE html>
<html>
<head>
  <title>Create User</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <nav>
    <a href="/">Home</a> |
    <a href="/graph">Graph</a> |
    <a href="/stats">Stats</a>
  </nav>
  <hr>
  <h2>Create User</h2>
  <form id="create-user-form">
    <style>
      /* Simple form grid for aligned labels and fields */
      #create-user-form {
        display: grid;
        grid-template-columns: 140px 1fr;
        grid-row-gap: 10px;
        grid-column-gap: 12px;
        align-items: center;
        max-width: 640px;
      }
      #create-user-form label {
        justify-self: end;
        padding-right: 6px;
      }
      #create-user-form input,
      #create-user-form textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 6px 8px;
      }
      #create-user-form textarea { height: 80px; }
      #create-user-form .full-row {
        grid-column: 1 / -1;
        justify-self: start;
      }
    </style>

    <label for="name">Name:</label>
    <input id="name" name="name" required />

    <label for="age">Age:</label>
    <input id="age" name="age" type="number" min="0" />

    <label for="gender">Gender:</label>
    <input id="gender" name="gender" />

    <label for="weight">Weight (lbs):</label>
    <input id="weight" name="weight" type="number" step="0.1" />

    <label for="notes">Notes:</label>
    <textarea id="notes" name="notes"></textarea>

    <div class="full-row">
      <button type="submit">Create</button>
    </div>
  </form>
  <div id="result"></div>

  <script>
    document.getElementById('create-user-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        name: document.getElementById('name').value.trim(),
        age: Number(document.getElementById('age').value) || null,
        gender: document.getElementById('gender').value.trim() || null,
        weight: Number(document.getElementById('weight').value) || null,
        notes: document.getElementById('notes').value.trim() || null,
      };
      try {
        const res = await fetch('/api/users', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (res.ok) {
          document.getElementById('result').textContent = 'Created user: ' + data.name + ' (id: ' + data.id + ')';
        } else {
          document.getElementById('result').textContent = 'Error: ' + (data.error || JSON.stringify(data));
        }
      } catch (err) {
        document.getElementById('result').textContent = 'Network error: ' + err;
      }
    });
  </script>
</body>
</html>